title: (03) Update Kernel 升级内核 - CentOS 7
date: 2015-03-27
categories: [CentOS]
tags: [CentOS]
description: 指令uname -r查看内核版本。升级内核的方法：导入key，安装elrepo的yum源，安装内核yum --enablerepo=elrepo-kernel install kernel-ml-devel kernel-ml -y。修改启动顺序 grub2-set-default 0，以此设置默认的启动的系统。
toc: false
---
<en-note><div>Ref From: <a shape="rect" href="http://www.linuxidc.com/Linux/2015-02/112697.htm" target="_blank">http://www.linuxidc.com/Linux/2015-02/112697.htm</a></div><div>Original Title: CentOS 7 升级内核的方法</div><div><br clear="none"/></div><div><p>默认<a shape="rect" title="CentOS" href="http://www.linuxidc.com/topicnews.aspx?tid=14" target="_blank">CentOS</a> 7的内核版本是3.10，<br clear="none"/>升级的原因是为了测试openvswitch的vlan技术，<br clear="none"/>默认openvswitch的2.3版本是允许CentOS 7默认内核3.10支持，<br clear="none"/>下面是软件与内核版本对比</p><p>    Open vSwitch  Linux kernel <br clear="none"/>  ------------  ------------- <br clear="none"/>      1.4.x      2.6.18 to 3.2 <br clear="none"/>      1.5.x      2.6.18 to 3.2 <br clear="none"/>      1.6.x      2.6.18 to 3.2 <br clear="none"/>      1.7.x      2.6.18 to 3.3 <br clear="none"/>      1.8.x      2.6.18 to 3.4 <br clear="none"/>      1.9.x      2.6.18 to 3.8 <br clear="none"/>      1.10.x    2.6.18 to 3.8 <br clear="none"/>      1.11.x    2.6.18 to 3.8 <br clear="none"/>      2.0.x      2.6.32 to 3.10 <br clear="none"/>      2.1.x      2.6.32 to 3.11 <br clear="none"/>      2.2.x      2.6.32 to 3.14</p><p>但如何想使用gre与vxlan的话，需要内核3.12以上的<br clear="none"/>    Protocol    Linux Kernel <br clear="none"/>  --------    ------------ <br clear="none"/>    GRE          3.11 <br clear="none"/>    VXLAN        3.12 <br clear="none"/>    LISP      &lt;not upstream&gt;<br clear="none"/>所以得升级内核。</p><p><br clear="none"/></p><p>更新前，<strong><span style="text-decoration: underline;">查看 内核版本</span>：</strong></p><p>[root@ip-10-10-17-4 tmp]# <strong>uname -r</strong> <br clear="none"/>3.10.0-123.el7.x86_64</p><p>目前最新的内核是3.18.3为stable，是2015年1月18日更新，<br clear="none"/>具体信息查看https://www.kernel.org/ </p><p><span style="text-decoration: underline;"><strong><br clear="none"/>升级内核 的 方法</strong></span><strong>：</strong></p><p>1. 导入key<br clear="none"/><strong>rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</strong><br clear="none"/>如果你修改了repo的gpgcheck=0也可以不导入key</p><p>2.安装elrepo的yum源<br clear="none"/>提醒：在上一篇教程<span style="text-decoration: underline;"> <strong>[02] 用CentOS 7打造合适的科研环境 </strong></span>安装了第三方源后，此步则不需要。<br clear="none"/><strong>rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm</strong></p><p>3. 安装内核<br clear="none"/>在yum的ELRepo源中，有mainline（3.18.3）这个内核版本<br clear="none"/><strong>yum --enablerepo=elrepo-kernel install  kernel-ml-devel kernel-ml -y</strong></p><p><br clear="none"/></p><p>选择了使用新安装的repo来安装3.18的内核，<br clear="none"/>如果使用其他的repo，看不到3.18版本内核。</p><p>更新后，查看内核版本：<br clear="none"/>[root@ip-10-10-17-4 tmp]# <strong>uname -r</strong> <br clear="none"/>3.10.0-123.el7.x86_64</p><p>重要提醒：目前内核还是默认的版本，<br clear="none"/>如果在这一步完成后你就直接reboot了，<br clear="none"/>重启后使用的内核版本还是默认的3.10，不会使用新的3.18。</p><p><br clear="none"/></p><p>*4. 想<span style="text-decoration: underline;"><strong>修改启动的顺序</strong></span>，需要进行下一步，查看默认启动顺序：</p><p><strong>awk -F\' '$1==&quot;menuentry &quot; {print $2}' /etc/grub2.cfg</strong> <br clear="none"/>CentOS Linux (3.18.3-1.el7.elrepo.x86_64) 7 (Core) <br clear="none"/>CentOS Linux, with Linux 3.10.0-123.el7.x86_64 <br clear="none"/>CentOS Linux, with Linux 0-rescue-893b160e363b4ec7834719a7f06e67cf</p><p>默认启动的顺序是从0开始，但我们新内核是从头插入（目前位置在0，而3.10的是在1），<br clear="none"/>所以需要选择0，如果想生效最新的内核，需要：</p><p><strong>grub2-set-default 0</strong></p><p><br clear="none"/></p><p>以上问题可以参考<a shape="rect" href="https://access.RedHat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sec-Customizing_GRUB_2_Menu.html#sec-Changing_the_Default_Boot_Entry" target="_blank">https://access.RedHat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sec-Customizing_GRUB_2_Menu.html#sec-Changing_the_Default_Boot_Entry</a></p><p>然后reboot重启，使用新的内核，下面是重启后使用的内核版本：<br clear="none"/>[root@ip-10-10-17-4 ~]# <strong>uname -r</strong> <br clear="none"/>3.18.3-1.el7.elrepo.x86_64</p><p>完成后内核已经是最新的了。</p></div></div>
